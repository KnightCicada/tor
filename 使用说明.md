# 安装必要软件

系统要求：Linux系统

## 安装tcpdump

```
centos/redhat下安装tcpdump
sudo yum install -y tcpdump
ubuntu下安装tcpdump
sudo apt-get install tcpdump
解决权限问题
使用whereis tcpdump 命令，找到tcpdump所在文件夹
在tcpdump所在目录下执行
sudo chmod u+s tcpdump
```

## 安装java环境

```
1、解压jdk
sudo tar -zxvf jdk -C /usr/local/java
2、设置JAVAhome
sudo vim /etc/profile
在文件末尾加上以下
export JAVA_HOME=/usr/local/java/jdk1.8.0_05
export JRE_HOME=$JAVA_HOME/jre
export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH
export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH
然后执行 source /etc/profile
```

## 安装Python环境

```
sudo apt install python3.6
导入必要的库
pip install pandas
pip install numpy
```

## 安装MySQL数据库

```
要求版本为8.0以上
```



# 修改配置文件

## 配置文件1

位置： /classify/config/application.properties

目前内容如下：

```
#thymeleaf
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.cache=false
spring.thymeleaf.content-type=text/html
spring.thymeleaf.enabled=true
spring.thymeleaf.encoding=UTF-8
#spring.thymeleaf.mode=HTML5
spring.thymeleaf.mode=LEGACYHTML5
# mybatis
mybatis.type-aliases-package=com.tor.domain
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.default-fetch-size=100
mybatis.configuration.default-statement-timeout=3000
# druid
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/tor?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&useSSL=false&&serverTimezone=Hongkong
spring.datasource.username=root
spring.datasource.password=123
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
pagehelper.helper-dialect=mysql
pagehelper.reasonable=true
pagehelper.support-methods-arguments=true
pagehelper.params=count=countSql
server.port=8082

main_path=/home/zyan/AW/data/

raw_pcap_path=/home/zyan/AW/data/pcap/
pcap_csv_path=/home/zyan/AW/data/pcap_csv/
arff_path=/home/zyan/AW/data/arff/
feature_path=/home/zyan/AW/data/feature/
model_info=/home/zyan/AW/data/model_info/
model=/home/zyan/AW/data/model/
python=/home/zyan/anaconda3/envs/tensorflow/bin/python3.6
makeLabelPy=/home/zyan/AW/data/tab/MakeLabel.py
remoteIP=207.246.88.214
remote_name=root
remote_password=4]hFU_g*XP=m)
remote_pcap_path=/root/pcap/
remote_pcap_to_local_path=/home/zyan/AW/data/pcap/remote/
remote_file_path=/root/aw/bridge/
remote_bridge_file=bridge.txt
local_file_path=/home/zyan/AW/data/local/
http_proxy=127.0.0.1
http_proxy_port=12333

```

要修改的配置项：

| 配置项名字                 | 原始值                                                       | 修改为                              | 说明 |
| -------------------------- | ------------------------------------------------------------ | ----------------------------------- | ---- |
| spring.datasource.url      | jdbc:mysql://127.0.0.1:3306/**tor**?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&useSSL=false&&serverTimezone=Hongkong | tor修改所创建的数据库名字           |      |
| spring.datasource.username | root                                                         | 数据库账号                          |      |
| spring.datasource.password | 123                                                          | 数据库密码                          |      |
| main_path                  | /home/zyan/AW/data/                                          | 自己创建的存放数据的文件夹          |      |
| python                     | /home/zyan/anaconda3/envs/tensorflow/bin/python3.6           | 安装的Python                        |      |
| remoteIP                   | 207.246.88.214                                               | 注入到Tor网络中的tor节点IP地址      |      |
| remote_name                | root                                                         | 注入到Tor网络中的tor节点VPS的用户名 |      |
| remote_password            | 4]hFU_g*XP=m)                                                | 注入到Tor网络中的tor节点VPS的密码   |      |
| http_proxy                 | 127.0.0.1                                                    | 本地代理服务器IP                    |      |
| http_proxy_port            | 12333                                                        | 本地代理服务器端口                  |      |



## 配置文件2

位置： /tordata/config/application.properties

目前内容如下：

```
#thymeleaf
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.cache=false
spring.thymeleaf.servlet.content-type=text/html
spring.thymeleaf.enabled=true
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.mode=HTML5
server.port=8081
# mybatis
mybatis.type-aliases-package=com.zyan.tordata.domain
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.default-fetch-size=100
mybatis.configuration.default-statement-timeout=3000
mybatis.mapperLocations = classpath:com/zyan/tordata/dao/*.xml
# druid
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/tor?characterEncoding=utf8&useSSL=false&serverTimezone=UTC&rewriteBatchedStatements=true&&serverTimezone=Hongkong
spring.datasource.username=root
spring.datasource.password=123
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.filters=stat
spring.datasource.maxActive=1000
spring.datasource.initialSize=100
spring.datasource.maxWait=60000
spring.datasource.minIdle=500
spring.datasource.timeBetweenEvictionRunsMillis=60000
spring.datasource.minEvictableIdleTimeMillis=300000
spring.datasource.validationQuery=select 'x'
spring.datasource.testWhileIdle=true
spring.datasource.testOnBorrow=false
spring.datasource.testOnReturn=false
spring.datasource.poolPreparedStatements=true
spring.datasource.maxOpenPreparedStatements=20
#static
spring.resources.add-mappings=true

spring.resources.chain.cache=true
spring.resources.chain.enabled=true

spring.resources.chain.html-application-cache=true
spring.resources.static-locations=classpath:/static/
#log

http_proxy=127.0.0.1
http_proxy_port=12333
```

要修改的配置项：

| 配置项名字                 | 原始值                                                       | 修改为                    | 说明 |
| -------------------------- | ------------------------------------------------------------ | ------------------------- | ---- |
| spring.datasource.url      | jdbc:mysql://127.0.0.1:3306/**tor**?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&useSSL=false&&serverTimezone=Hongkong | tor修改所创建的数据库名字 |      |
| spring.datasource.username | root                                                         | 数据库账号                |      |
| spring.datasource.password | 123                                                          | 数据库密码                |      |
| http_proxy                 | 127.0.0.1                                                    | 本地代理服务器IP          |      |
| http_proxy_port            | 12333                                                        | 本地代理服务器端口        |      |



## 配置文件3

位置： /tordata/config/application.properties

目前内容如下：

```
consenses=/
ip=
port=
```

要修改的配置项：

| 配置项名字 | 原始值                                                       | 修改为                         | 说明 |
| ---------- | ------------------------------------------------------------ | ------------------------------ | ---- |
| consenses  | jdbc:mysql://127.0.0.1:3306/**tor**?useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true&useSSL=false&&serverTimezone=Hongkong | tor修改所创建的数据库名字      |      |
| ip         | 127.0.0.1                                                    | 注入到Tor网络中的tor节点IP地址 |      |
| port       | 9001                                                         | 注入到Tor网络中的tor节点端口   |      |



# 执行先行脚本

## 脚本1：local_first.sh

在本地执行，作用：创建必要的存储数据的文件夹，需要先修改之前的配置文件

```
# /bin/sh

main_dir=`sed '/^main_path=/!d;s/.*=//' ./classify/config/application.properties`  

echo $main_dir

cd $main_dir23

mkdir pcap
mkdir pcap_csv
mkdir pcap/remote
mkdir feature
mkdir arff
mkdir model_info
mkdir model
mkdir tab
mkdir localfile

cp ./file/MakeLabel.py $main_dir/tab/



```

## 脚本2：server_first.sh

```
# /bin/sh

mkdir /home/aw/bridge
mkdir pcap_csv
mkdir pcap/remote
mkdir feature
mkdir arff
mkdir model_info
mkdir model
mkdir tab
mkdir localfile

cp ./file/MakeLabel.py $main_dir/tab/
```



# 使用说明

1、上述配置文件以及脚本执行完成之后，无需再次执行

2、java -jar ./classify/torClassify-0.0.1-SNAPSHOT.jar 

3、java -jar ./tordata/tordata-execute.jar

4、打开浏览器，输入127.0.0.1:8082/home

5、打开浏览器，输入127.0.0.1:8082/index

